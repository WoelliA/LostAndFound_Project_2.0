LostAndFound.Model.ParseHelper={copyAttributes:function(n,t){var i=t.attributes;for(var r in i)n[r]=i[r];n.id=t.id},copyArray:function(n,t){var r=[],u,f,i;for(u in n)f=n[u],i=t?t():{},this.copyAttributes(i,f),r.push(i);return r}};LostAndFound.Model.GeoModel=function(){var n={},r={lng:10,lat:50,zoom:5},t="map-options",u=function(){return n},i=function(){return window.city?window.city:e()||r},f=function(n){localStorage.setItem(t,JSON.stringify(n))},e=function(){var n=localStorage.getItem(t);return n?JSON.parse(n):null},o=function(n){if(window.city){n(window.city);return}var t=i();n(t);navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){var i={};i.lng=t.coords.longitude;i.lat=t.coords.latitude;n(i)},function(){})};return n.saveGeoSettings=f,n.getDefaultLocation=i,n.getCurrentLocation=o,n.init=u,n}();LostAndFound.Model.ReportsModel=function(){var n={},r=Parse.Object.extend("report"),o=["lat","lng","imageURL","category"],t=[],s=function(){return n},h=function(n,r){if(t[n]){r(t[n]);return}var u=new Parse.Query("report");u.include("category");u.get(n,function(n){var t=i([n])[0];r(t)})},c=function(n,t){var i=new r,f,h,c,a,s;for(f in n)(h=n[f],h instanceof Function||o.indexOf(f)>=0)||i.set(f,n[f]);c=new Parse.GeoPoint(n.lat,n.lng);a=e(n.category.id);i.set("category",a);i.set("location",c);n.imageURL?(s=l(n.imageURL),s.save().then(function(){i.set("image",s);u(i,t)},function(n){console.log(n)})):u(i,t)},u=function(n,t){n.save({success:function(){var r=i([n])[0];t.success(r)},error:function(n){console.log(n)}})},l=function(n){var t={base64:n};return new Parse.File("afile",t)},a=function(n,t){var i=f(n);i.count({success:function(n){t.success(n)},error:function(n){console.log(n)}})},f=function(n){var t=new Parse.Query(r),i=n.sector,u,f,e;return t.equalTo("type",n.type),u=v(n.itemTypes),t.containedIn("category",u),f=new Parse.GeoPoint(i.latMin,i.longMin),e=new Parse.GeoPoint(i.latMax,i.longMax),t.withinGeoBox("location",e,f),t},v=function(n){for(var i=[],t=0;t<n.length;t++)i.push(e(n[t]));return i},e=function(n){var i=Parse.Object.extend("category"),t=new i;return t.set("id",n),t},i=function(n){var i=LostAndFound.Model.ParseHelper.copyArray(n,function(){return new LostAndFound.Model.Report});return i&&i.forEach(function(n){if(n){if(t[n.id]=n,n.category){var r=n.category.id,i={};n.category.get("shortname")?LostAndFound.Model.ParseHelper.copyAttributes(i,n.category):i=LostAndFound.Model.ConfigModel.getItemTypeForId(r);n.category=i}n.image&&(n.imageURL=n.image.url());n.location&&(n.lng=n.location.longitude,n.lat=n.location.latitude)}}),i},y=function(n,t){var r=f(n);r.limit(n.pageSize);r.skip(n.offset);r.descending("createdAt");r.find({success:function(n){t(i(n))},error:function(n){console.log(n)}})};return n.getReportsCount=a,n.saveReport=c,n.getReport=h,n.getReports=y,n.init=s,n}();LostAndFound.Model.ConfigModel=function(){var n={},i=Parse.Object.extend("category"),t={},r=function(){return n},u=function(n){return LostAndFound.Model.ParseHelper.copyArray(n)},f=function(n){return t[n]},e=function(n){if(LostAndFound.Model.Categories&&LostAndFound.Model.Categories.length>0){n(LostAndFound.Model.Categories);return}var r=LostAndFound.Model.Categories=[],f=new Parse.Query(i);f.find({success:function(i){var f=u(i);f.forEach(function(n){t[n.id]=n;r.push(n)});n(f)},error:function(n){console.log(n)}})};return n.getItemTypeForId=f,n.getItemTypes=e,n.init=r,n}();